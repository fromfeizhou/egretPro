module com_main {
	/**
	 * 军功排行奖励
	 */
	export class ExploitRankAwardCell extends eui.ItemRenderer {
		public m_RankLab: com_main.CLabel;
		public m_RankImg: com_main.CImage;
		public m_pMilitoryValue: com_main.CLabel;
		public m_comState: com_main.ComState;
		public m_PlayerName: com_main.CLabel;
		public m_PlayerLegion: com_main.CLabel;
		public m_PlayerHead: com_main.ComHeadItem;
		public m_plbNoAward: com_main.CLabel;
		public m_RewardRoot: eui.List;

		private m_tCollections: eui.ArrayCollection;

		private m_tData: gameProto.ICommRank;
		public constructor() {
			super();
		}

		$onRemoveFromStage(isclear = true): void {
			this.onDestroy();
			super.$onRemoveFromStage();
		}

		public onDestroy(): void {
			EventManager.removeEventListeners(this);
		}

		protected childrenCreated(): void {
			super.childrenCreated();

		}
		public dataChanged() {
			super.dataChanged();
			this.Refresh();
		}

		private Refresh(): void {
			this.m_tData = this.data;
			if (!this.m_tData) return;
			this.Refresh_Rank()
			this.Refresh_Player();
			this.Refresh_Country();
			this.Refresh_Award();
			this.Refresh_Militory();
			// this.refreshLegion();
		}
		/**刷新排行 */
		private Refresh_Rank(): void {
			RankModel.refreshRankIcon(this.m_RankImg,this.m_RankLab,this.m_tData.rank);
		}
		/**刷新玩家信息 */
		private Refresh_Player(): void {
			let headInfo = this.m_tData.playerHead;
			this.m_PlayerName.text = headInfo.playerName;
			this.m_PlayerHead.info = headInfo;
		}
		/**刷新国家信息 */
		private Refresh_Country(): void {
			this.m_comState.stateId = this.m_tData.playerHead.countryId;

		}
		/**
 		* 刷新战功有关的
 		*/
		private Refresh_Militory(): void {
			if (this.m_pMilitoryValue && this.m_tData.value>=0) {
				this.m_pMilitoryValue.text = this.m_tData.value.toString(10);
			}

		}
		/**刷新奖励 */
		private Refresh_Award(): void {
			this.m_plbNoAward.visible = (this.m_tData.playerHead.playerId == RoleData.playerId) && (this.m_tData.rank == 0 || this.m_tData.rank == -1)
			let militoryAwardCfg: MilitaryMeritsRankRewardConfig = C.MilitaryMeritsRankRewardConfig[this.m_tData.rank];
			this.m_tCollections = new eui.ArrayCollection([]);
			this.m_RewardRoot.dataProvider = this.m_tCollections;
			this.m_RewardRoot.itemRenderer = MilitoryAwardRender;
			if (!militoryAwardCfg)
				return;
			let items = Utils.parseCommonItemJson(militoryAwardCfg.reward);
			this.m_tCollections.replaceAll(items);

		}
	

	}

	/**战功奖励 */
	export class MilitoryAwardRender extends eui.ItemRenderer {
		public m_item: ComItemNew;
		protected m_tData: IItemInfo;
		public constructor() {
			super();
		}

		$onRemoveFromStage(): void {
			super.$onRemoveFromStage();
		}

		protected childrenCreated(): void {
			super.childrenCreated();
			this.removeChildren();
			this.m_item = ComItemNew.create('count');
			this.addChild(this.m_item);

		}

		protected dataChanged() {
			this.m_tData = this.data as IItemInfo;
			this.m_item.setItemInfo(this.m_tData.itemId, this.m_tData.count);
		}
	}
}